import{r as n,i as v,F as C,j as t,m as M,b as A,u as F,c as S,L as p,t as b}from"./index-Bs4g6r69.js";import{a as T}from"./provider.store-DE4c5zcz.js";import{u as k}from"./useQuery-DOkwqUNL.js";import{u as E}from"./useTextInput-Cl3OHoDr.js";import{A as I}from"./AppForm-f22Hy1bX.js";const L=({myUid:a,uid:o,id:c,cid:i,onFocus:u,isFinished:d})=>{const[e,m]=n.useState(""),r=E(),h=n.useCallback(async()=>{if(e.length===0)return alert("아무것도 입력되지 않았습니다."),r.focus();const x={createdAt:new Date().toLocaleString(),id:"",message:e,uid:a,uids:[a,o]};try{await v.collection(C.MATCHING).doc(c).collection(i).add(x),m(""),r.focus(),u()}catch(f){return alert(f.message)}},[e,o,a,r,c,i,u]);return t.jsxs(I,{className:"flex-row gap-x-2.5 max-w-auto w-full relative",onSubmit:h,children:[d&&t.jsx("button",{type:"button",className:"absolute w-full h-full top-0 left-0 z-10",onClick:()=>alert("해당 공고는 모집 종료되었습니다."),children:"모집 종료"}),t.jsx(r.Component,{value:e,onChangeText:m,label:"",resetHidden:!0,divClassName:"flex-1",props:{className:"border-none focus:bg-lightgray"}}),t.jsx("button",{className:"primary",children:"전송"})]})},q=a=>{const o=M(),{team:c}=T(),i=v.collection(C.MATCHING).doc(o.id),{isPending:u,error:d,data:e}=k({queryKey:["teams",o.id],queryFn:async()=>{try{const s=await i.get(),l={...s.data(),id:s.id};return l||null}catch(s){return console.log(s),null}},initialData:c}),m=n.useMemo(()=>(e==null?void 0:e.uid)===a.uid,[e==null?void 0:e.uid,a.uid]),r=A()[0].get("cid"),h=F(),{pathname:x}=S(),[f,j]=n.useState([]),g=n.useRef(null),w=n.useCallback(()=>setTimeout(()=>{var s;return(s=g.current)==null?void 0:s.scrollIntoView()},100),[g]);return n.useEffect(()=>{if(r){//! 순서를 만들어주는 함수 orderBy(조건이될 값, 오름차순/내림차순)
return i.collection(r).orderBy("createdAt","asc").onSnapshot(l=>{const y=l.docs.map(N=>({...N.data(),id:N.id}));j(y||[])})}},[o.id,r]),console.log(i),n.useEffect(()=>{w()},[]),u?t.jsx(p,{message:"공고를 불러오고 있습니다..."}):d?t.jsx(p,{message:`Error: ${d.message}`,iconClassName:"text-red-500"}):e?m&&!r?t.jsxs("div",{children:[t.jsxs("h1",{children:[e.name," - ",e.targets.length,"개의 직군 구함"]}),e.fid.length>0?e.fid.map(s=>t.jsxs("button",{onClick:()=>h(`${x}?cid=${s}`),children:[s," 님과의 상담"]},s)):t.jsx("p",{children:"해당 공고를 스크랩한 유저가 존재하지 않습니다."})]}):t.jsxs("div",{className:"h-[calc(100vh-60px)] col",children:[t.jsx("div",{className:"flex-1 bg-lightGray p-5 max-h-[calc(100vh-141px)] overflow-y-auto overflow-x-hidden",children:t.jsx("ul",{className:"col gap-y-2.5",children:f.map((s,l)=>t.jsx("li",{className:b("row",a.uid===s.uid&&"justify-end"),ref:l===f.length-1?g:null,children:t.jsxs("div",{className:b("p-2.5 border border-border max-w-75 rounded-xl relative bg-white",a.uid===s.uid&&"bg-theme text-white"),children:[s.message,t.jsx("span",{className:b("absolute bottom-0 w-screen text-gray-400 block text-xs font-light",a.uid===s.uid?"right-[calc(100%+10px)] text-right":"left-[calc(100%+10px)] text-left"),children:s.createdAt.split(" ")[1]})]})},s.id))})}),t.jsx(L,{myUid:a.uid,uid:e==null?void 0:e.uid,cid:r,id:e.id,onFocus:w,isFinished:e==null?void 0:e.isFinished})]}):t.jsx(p,{message:"존재하지 않는 공고입니다.",iconClassName:"text-zinc-900"})};export{q as default};
