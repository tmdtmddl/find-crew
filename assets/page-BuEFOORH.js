import{d as U,r as n,i as I,F as E,j as t,L as $,A as z,o as H,u as W}from"./index-Bs4g6r69.js";import{a as q}from"./provider.store-DE4c5zcz.js";import{u as y}from"./useTextInput-Cl3OHoDr.js";import{u as J}from"./useSelect-Rm0HkCHZ.js";import{j as Q}from"./index-CEzudzDZ.js";import{A as V}from"./AppForm-f22Hy1bX.js";import{l as g,i as M}from"./validator-iAbv46Dp.js";const X={descs:[],fid:[],id:"",intro:"",members:[],name:"",targets:[],uid:""},Y=({payload:a,onCancel:m,onSubmitEditing:u})=>{const{user:l}=U(),[s,P]=n.useState(a??{...X,uid:l==null?void 0:l.uid,members:[l]}),[b,k]=n.useState(""),[R,x]=n.useState(!1),[d,G]=n.useState(""),[T,S]=n.useState(!1),i=n.useCallback((e,r)=>{P(o=>({...o,[e]:r}))},[]),p=y(),j=J(),f=y(),B=y(),A=n.useRef(null),D=n.useCallback(()=>setTimeout(()=>{var e;return(e=A.current)==null?void 0:e.focus()},100),[]),C=n.useMemo(()=>g(s.name)?null:"회사/팀 이름을 입력해주세요.",[s.name]),N=n.useMemo(()=>g(s.targets)?null:"구인 직군을 1개 이상 선택해주세요.",[s.targets]),w=n.useMemo(()=>g(s.intro)?null:"회사 소개를 입력해주세요.",[s.intro]),v=n.useMemo(()=>g(s.descs)?null:"최소 1개 이상의 세부 자격 요건을 입력해주세요.",[s.descs]),F=n.useCallback(async()=>{try{if(s.members.find(h=>h.email===d))return alert("이미 추가된 멤버입니다.");const c=(await I.collection(E.USERS).where("email","==",d).get()).docs.map(h=>({...h.data(),uid:h.id}));if(!c)return alert("검색된 멤버가 존재하지 않습니다.");if(c[0]&&confirm(`${c[0].name} 님이 맞으신가요?`))return i("members",[...s.members,c[0]]),alert("멤버가 추가되었습니다."),x(!1);alert("멤버가 존재하지 않습니다.")}catch(e){return alert(e.message)}},[d,s.members,i]),[K,L]=n.useTransition(),O=n.useCallback(()=>{if(!T){if(C)return alert(C),p.focus();if(N)return alert(N),j.showPicker();if(w)return alert(w),D();if(v)return alert(v),f.focus();L(async()=>{try{const e=I.collection(E.MATCHING);if(a){if(a.name===s.name&&a.intro===s.intro&&M(a.targets,s.targets)&&M(a.descs,s.descs)&&M(a.members.map(r=>r.uid),s.members.map(r=>r.uid)))return alert("변경사항이 없습니다.");await e.doc(a.id).update(s)}else await e.add(s);alert(`공고가 ${a?"수정":"등록"}되었습니다.`),m(),u&&u()}catch(e){alert(e.message)}})}},[m,u,s,C,v,N,w,p,f,j,D,a,T]);return t.jsxs(V,{onSubmit:O,children:[K&&t.jsx($,{message:a?"공고를 수정하고 있습니다...":"공고를 등록중입니다..."}),t.jsx(p.Component,{value:s.name,label:"회사이름/팀이름",onChangeText:e=>i("name",e),placeholder:"DW 아카데미"}),t.jsxs("div",{className:"col gap-y-1",children:[t.jsx("div",{className:"row",children:t.jsx(j.Component,{data:Q,label:"구인 직군",onChangeSelect:e=>{const r=s.targets.find(o=>o===e);i("targets",r?s.targets.filter(o=>o!==e):[e,...s.targets])},value:"",containerClassName:"min-w-25"})}),s.targets.length>0&&t.jsx("ul",{className:"wrap",children:s.targets.map(e=>t.jsx("li",{children:t.jsx("button",{type:"button",onClick:()=>i("targets",s.targets.filter(r=>r!==e)),className:"h-auto p-1 text-sm text-gray-500",children:e})},e))})]}),t.jsxs("div",{className:"col gap-y-1",children:[t.jsx("label",{htmlFor:"intro",className:"text-gray-500 text-sm",children:"회사/팀 소개"}),t.jsx("textarea",{ref:A,value:s.intro,onChange:e=>i("intro",e.target.value),placeholder:"회사소개 내용을 철저하게 입력하세요. 좋은 팀원을 구할 수 있는 첫 번째 지름길입니다.",className:"resize-none h-[20vh] p-2.5 border border-border rounded bg-lightGray focus:bg-white outline-none focus:border-theme min-h-25"})]}),t.jsx(f.Component,{label:"세부 자격 요건",onChangeText:k,value:b,placeholder:"웹사이트 개발 고수",props:{onKeyDown:({key:e,nativeEvent:r})=>{if((e==="Enter"||e==="Tab")&&!r.isComposing){if(s.descs.find(c=>c===b))return alert("중복된 경력 사항입니다.");i("descs",[...s.descs,b]),k(""),f.focus()}},onFocus:()=>S(!0),onBlur:()=>S(!1)}}),s.descs.length>0&&t.jsx("ul",{className:"col gap-y-1",children:s.descs.map((e,r)=>t.jsxs("li",{className:"text-sm border border-border rounded px-1 bg-lightGray row justify-between items-center",children:[r+1,". ",e,t.jsx("button",{type:"button",className:"h-auto p-0",onClick:()=>i("descs",s.descs.filter(o=>o!==e)),children:t.jsx(z,{})})]},e))}),t.jsxs("div",{className:"col gap-y-1",children:[t.jsx("label",{htmlFor:"add-mem",className:"text-sm text-gray-500",children:"멤버"}),t.jsx("button",{type:"button",id:"add-mem",onClick:()=>x(!0),children:"멤버추가"}),s.members.length>0&&t.jsx("ul",{className:"wrap",children:s.members.map(e=>t.jsx("li",{children:t.jsxs("button",{type:"button",className:"h-auto py-1",onClick:()=>{if(s.members.find(o=>o.uid===(l==null?void 0:l.uid)))return alert("자신은 삭제할 수 없습니다.");i("members",s.members.filter(o=>o.uid!==e.uid))},children:[e.email," ",e.name]})},e.uid))})]}),R&&t.jsxs("div",{className:"modal flex justify-center items-center bg-black/20",children:[t.jsx("span",{className:"modal-bg"}),t.jsxs("div",{className:"modal-content bg-white p-5 rounded-xl border border-border shadow-md row gap-x-2.5 items-end",children:[t.jsx("button",{type:"button",className:"absolute top-2.5 right-2.5 h-5 w-5 p-0 bg-white text-gray-500 hover:text-black",onClick:()=>x(!1),children:t.jsx(H,{})}),t.jsx(B.Component,{value:d,label:"이메일",onChangeText:G,placeholder:"member@email.com",props:{onKeyDown:async({key:e,nativeEvent:r})=>{(e==="Enter"||e==="Tab")&&(r.isComposing||F())}}}),t.jsx("button",{type:"button",className:"primary",onClick:F,children:"검색"})]})]}),t.jsxs("div",{className:"row gap-x-2.5 mt-2.5",children:[t.jsx("button",{type:"button",className:"flex-1",onClick:m,children:"취소"}),t.jsx("button",{className:"flex-2 primary",children:a?"수정":"등록"})]})]})},ae=()=>{const{team:a,setTeam:m}=q(),u=W();return t.jsx("div",{children:t.jsx(Y,{payload:a??void 0,onCancel:()=>{u(-1)},onSubmitEditing:()=>m(null)})})};export{ae as default};
