import{m as b,r as l,d as v,u as k,i as a,F as o,j as i,L as d}from"./index-Bf2mX5nG.js";import{a as F}from"./provider.store-BmVc1iV0.js";import{F as M}from"./FindItem-CRBqAs_f.js";import{u as T}from"./useQuery-DJK2cZHU.js";const H=()=>{const f=b(),{team:j,setTeam:c}=F(),{isPending:p,error:g,data:e}=T({queryKey:["teams",f.id],queryFn:async()=>{try{const n=await a.collection(o.MATCHING).doc(f.id).get(),m={...n.data(),id:n.id};return m||null}catch(s){return console.log(s),null}},initialData:j}),[y,u]=l.useTransition(),[C,x]=l.useState(""),{user:t}=v(),r=k(),N=l.useCallback(()=>{u(async()=>{if(x("공고를 스크랩중입니다."),!!e){if(!t){if(confirm("로그인이 필요한 기능입니다. 로그인 하시겠습니까?")){r("/login");return}return}if(t.uid===(e==null?void 0:e.uid))return alert("자신의 공고입니다.");try{const s=a.collection(o.USERS).doc(t.uid).collection(o.MY).doc(e.id),n=a.collection(o.MATCHING).doc(e.id);if((await s.get()).data())return alert("이미 스크랩한 공고입니다.");const h={...e,fid:[...e.fid,t.uid]};await s.set(h),await n.set(h),confirm('공고를 스크랩했습니다. "나의 매칭 진행중 팀" 에서 확인할 수 있습니다. 지금 확인하시겠습니까?')&&r("/my?content=matching")}catch(s){alert(s.message)}}})},[e,t,r]),w=l.useCallback(()=>{u(async()=>{if(!t){if(confirm("로그인이 필요한 기능입니다. 로그인 하시겠습니까?")){r("/login");return}return}if(t.uid===(e==null?void 0:e.uid))return alert("자신의 공고입니다.");try{const s=a.collection(o.MATCHING).doc(e==null?void 0:e.id).collection(t.uid),n={createdAt:new Date().toLocaleString(),message:`${e==null?void 0:e.name}의 공고를 보고 연락드립니다.`,uid:t.uid,uids:[e==null?void 0:e.uid,t.uid],id:""};await s.add(n),alert("문의를 시작합니다."),r(`/find/${e==null?void 0:e.id}/chat?cid=${t.uid}`),c(e)}catch(s){return alert(s.message)}})},[e,t,c,r]);return p?i.jsx(d,{message:"공고를 불러오고 있습니다..."}):g?i.jsx(d,{message:`Error: ${g.message}`,iconClassName:"text-red-500"}):e?i.jsxs("div",{className:"p-5",children:[y&&i.jsx(d,{message:C}),e&&i.jsxs("div",{children:[(t==null?void 0:t.uid)===e.uid&&i.jsxs("div",{className:"row gap-x-2.5 justify-end mb-2.5",children:[i.jsx("button",{className:"hover:text-theme",onClick:()=>{c(e),r("/find/matching-teams")},children:"수정"}),i.jsx("button",{className:"hover:text-red-500",onClick:()=>{confirm("해당 공고를 삭제하시겠습니까?")&&u(async()=>{x("공고를 삭제중입니다.");try{await a.collection(o.MATCHING).doc(e.id).delete(),alert("공고가 삭제되었습니다."),r("/find"),c(null)}catch(s){return alert(s.message)}})},children:"삭제"})]}),i.jsx(M,{item:e,isFull:!0})]}),i.jsxs("div",{className:"row gap-x-2.5 mt-5",children:[i.jsx("button",{onClick:N,className:"primary",children:"팀 매칭 시작하기"}),i.jsx("button",{onClick:w,children:"문의하기"}),i.jsx("button",{onClick:()=>console.log(e),children:"확인"})]})]}):i.jsx(d,{message:"존재하지 않는 공고입니다.",iconClassName:"text-zinc-900"})};export{H as default};
